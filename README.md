# POSSIM Customer Priority Maker

VHC1～HCU12期の顧客データを処理し、営業優先度付き顧客リストを作成するツール

## 📋 このツールについて

このツールは、VHC1～HCU12期（全12期分）の顧客データを自動的に整理し、営業担当者が優先的にコンタクトすべき顧客リストをExcel形式で作成します。

### 主な機能

- **12期分のデータを1つにまとめる**: VHC1～HCU12期のすべてのデータを統合
- **VHC6期のデータを正確に計算**: 差分計算により正確なVHC6期データを取得
- **重複した顧客を削除**: 1人の顧客が複数の期に参加していた場合、最も新しい期のデータを残す
- **優先順位を自動で付ける**: 営業で優先的に接触すべき順番を自動的に決定
- **地域ごとに人数を集計**: 都道府県別に何人いるかを自動で集計
- **Excelファイルで出力**: 4つのシートに分かれた見やすいExcelファイルを作成

## 使い方

### ステップ1: 必要なファイルを準備する

以下のフォルダ構成でファイルを配置してください：

```
possim_customer_priority/
├── customer_list/          ← 顧客データのCSVファイルを入れるフォルダ
│   ├── hubspot-crm-exports-vhc1-2025-11-04.csv
│   ├── hubspot-crm-exports-vhc2-2025-11-04.csv
│   ├── hubspot-crm-exports-vhc3-2025-11-04.csv
│   ├── hubspot-crm-exports-vhc4-2025-11-04.csv
│   ├── hubspot-crm-exports-vhc5-2025-11-04.csv
│   ├── hubspot-crm-exports-hcu7-2025-11-04.csv
│   ├── hubspot-crm-exports-hcu8-2025-11-04.csv
│   ├── hubspot-crm-exports-hcu9-2025-11-04.csv
│   ├── hubspot-crm-exports-hcu10-2025-11-04.csv
│   ├── hubspot-crm-exports-hcu11-2025-11-04.csv
│   ├── hubspot-crm-exports-hcu12-2025-11-04.csv
│   └── hubspot-crm-exports-hcuandvhc-2025-11-05.csv
├── surveys/                ← アンケートデータのExcelファイルを入れるフォルダ
│   ├── HCU7期卒業式アンケート（回答）.xlsx
│   ├── ★８期生　表彰式アンケート（回答）.xlsx
│   ├── 9期生　卒業式アンケート（回答）.xlsx
│   ├── HCU10期 卒業式アンケート（回答）.xlsx
│   └── HCU11期 卒業式アンケート （回答）.xlsx
├── output/                 ← 処理結果が保存されるフォルダ
└── possim_customer_priority_maker.py
```

### ステップ2: 必要なライブラリをインストールする

Windowsの場合はコマンドプロンプト、Macの場合はターミナルを開いて、以下のコマンドを実行してください：

```bash
pip install -r requirements.txt
```

このコマンドで、ツールを動かすために必要なプログラム部品が自動的にインストールされます。

### ステップ3: ツールを実行する

コマンドプロンプト（またはターミナル）で以下のコマンドを実行してください：

```bash
python possim_customer_priority_maker.py
```

実行すると、画面に処理の進行状況が表示されます。すべて完了すると「処理が完了しました」というメッセージが表示されます。

### ステップ4: 作成されたファイルを確認する

`output`フォルダの中に `POSSIM_顧客リスト_優先順位付き.xlsx` というExcelファイルが作成されています。
このファイルを開いて内容を確認してください。

## 📊 作成されるExcelファイルの内容

Excelファイルには4つのシートが含まれています：

### シート1: 営業リスト

営業担当者が使用するメインの顧客リストです。優先順位の高い順（1→2→3→4）に並んでいます。

| 列名 | 説明 |
|-----|------|
| 優先順位 | 1～4の数字。1が最優先、4が最も優先度が低い |
| 氏名 | 顧客の名前 |
| 電話番号 | 整形された電話番号（例：090-1234-5678） |
| メールアドレス | 顧客のメールアドレス |
| 郵便番号 | 整形された郵便番号（例：123-4567） |
| 住所 | 顧客の住所（都道府県 + 市区町村 + 番地） |
| 都道府県 | 都道府県のみ |
| 最後に受講した期 | 最後に受講した期（VHC1～HCU12のいずれか） |
| アンケート回答 | 卒業式アンケートに回答したかどうか（True=回答済、False=未回答） |

**優先順位の決め方**:
- **優先順位1**: 最後に参加したのが12期の顧客（最も新しい顧客）
- **優先順位2**: 7～11期に参加し、アンケートに回答した顧客
- **優先順位3**: 7～11期に参加したが、アンケートに未回答の顧客
- **優先順位4**: 1～6期に参加した顧客（比較的古い顧客）

### シート2: 地域別集計結果

地域ごとの人数を集計した表です：

| 集計項目 | 説明 |
|---------|------|
| A. 東京都在住 | 東京都に住んでいる顧客の人数 |
| B. 埼玉・千葉・神奈川在住 | 東京近郊（埼玉・千葉・神奈川）に住んでいる顧客の人数 |
| C. 7期以降 + 東京都在住 | 7期以降に参加し、東京都に住んでいる顧客の人数 |
| D. 7期以降 + 近県在住 | 7期以降に参加し、東京近郊に住んでいる顧客の人数 |

### シート3: 優先順位別の人数

優先順位ごとに何人いるかを示した表です：

| 優先順位 | 説明 |
|---------|------|
| 優先順位1（12期生） | 最後に参加したのが12期の顧客の人数 |
| 優先順位2（7～11期 + アンケート回答） | 7～11期でアンケート回答者の人数 |
| 優先順位3（7～11期 + 未回答） | 7～11期でアンケート未回答者の人数 |
| 優先順位4（1～6期） | 1～6期の顧客の人数 |

### シート4: 各種チェック項目

データの品質をチェックした結果です。各項目に何件データがあるかを確認できます：

- 電話番号データ件数
- 郵便番号データ件数
- 住所データ件数
- 都道府県データ件数
- メールアドレスデータ件数
- 住所の重複チェック

## 処理の流れ

このツールは以下の手順で自動的に処理を行います：

### ステップ1: 各期のデータを読み込む
VHC1～5期とHCU7～12期の合計11期分のCSVファイルを読み込みます。

### ステップ2: VHC6期のデータを計算で取得する
全体のデータから11期分を差し引くことで、VHC6期のデータを計算します。

**計算の考え方**:
- 全体のデータ - (VHC1～5期 + HCU7～12期) = VHC6期のデータ

### ステップ3: 12期分をすべて統合する
11期分のデータ + VHC6期のデータ = 全12期分のデータを1つにまとめます。

### ステップ4: 名前とメールアドレスを整理する
- 姓と名を組み合わせて氏名を作成
- 氏名からスペースや記号を削除して統一
- メールアドレスを小文字に統一

### ステップ5: 重複している顧客を削除する
1人の顧客が複数の期に参加している場合、最も新しい期のデータだけを残します。
例：同じ人がVHC3期とHCU10期に参加→HCU10期のデータを残す

### ステップ6: 都道府県情報を追加する
データベースから都道府県情報を取得して追加します。

### ステップ7: 住所から都道府県を抽出する
住所のテキストから都道府県名を抽出します。

### ステップ8: 地域ごとに集計する
都道府県ごとに何人いるかを集計します。

### ステップ9: アンケート情報を追加する
卒業式アンケートに回答したかどうかの情報を追加します。

### ステップ10: 優先順位を決定する
営業での優先度を自動的に計算して付与します。

### ステップ11: 電話番号と郵便番号を見やすく整形する
- 電話番号を「090-1234-5678」のような形式に整形
- 郵便番号を「123-4567」のような形式に整形
- 住所を「都道府県 + 市区町村 + 番地」の形で作成

### ステップ12: Excelファイルを出力する
4つのシートを持つExcelファイルを作成します。

## 🔍 重要な注意事項

### VHC6期のデータについて

**使用してはいけないファイル**:
- `VHC6期生データ.csv` ← 手作業で作成されたファイルのため使用しない
- `6期生以外の全量データ_顧客リスト統合版.xlsx` ← 正確性が保証されないため使用しない

**正しい方法**:
差分計算で自動的に取得します：

```python
# 手順1: VHC1～5期とHCU7～12期の11期分を読み込む
df_non_vhc6 = pd.concat([df_vhc1, df_vhc2, ..., df_vhc5, df_hcu7, ..., df_hcu12])

# 手順2: 全体のデータを読み込む
df_all = pd.read_csv('hubspot-crm-exports-hcuandvhc-2025-11-05.csv')

# 手順3: 差し引いてVHC6期を取得
vhc6_emails = all_emails - non_vhc6_emails
df_vhc6 = df_all[df_all['Eメール'].isin(vhc6_emails)]
```

### 重複削除の方法

1人の顧客が複数の期に参加している場合、**最も新しい期のデータを残す**仕組みになっています：

```python
# 期の番号で並べ替え（新しい期が先頭に来るように）
df_sorted = df.sort_values('期_番号', ascending=False)

# メールアドレスで重複をチェックし、最初のレコード（=最新の期）を残す
df_dedup = df_sorted.drop_duplicates(subset=['Eメール'], keep='first')
```

### 電話番号の整形ルール

- **11桁の場合**: 090-1234-5678 の形式に整形
- **10桁の場合**: 03-1234-5678 の形式に整形
- **その他**: 元のままの形で残す

## 📝 このツールについて

このツールは、POSSIMの内部業務効率化のために作成されました。

## 作成者

KATSUMI KURAHASHI

## 最終更新日

2025-11-05
