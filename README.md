# POSSIM Customer Priority Maker

VHC1～HCU12期の顧客データを処理し、営業優先度付き顧客リストを作成するツール

## 📋 概要

このツールは、VHC1～HCU12期の顧客データを統合し、営業優先度を付与した顧客リストをExcel形式で出力します。

### 主な機能

- **12期分のデータ統合**: VHC1～HCU12期のすべてのデータを統合
- **VHC6期の差分計算**: 正確なVHC6期データを差分計算で取得
- **重複削除**: 最後に受講した期のデータを保持
- **優先順位付与**: 営業優先度に基づいて顧客をランク付け
- **地域別集計**: 都道府県別の人数を集計
- **Excel出力**: 4シート構成のExcelファイルを出力

## 使い方

### 1. 必要なファイルを配置

以下のディレクトリ構造でファイルを配置してください：

```
possim_customer_priority/
├── customer_list/
│   ├── hubspot-crm-exports-vhc1-2025-11-04.csv
│   ├── hubspot-crm-exports-vhc2-2025-11-04.csv
│   ├── hubspot-crm-exports-vhc3-2025-11-04.csv
│   ├── hubspot-crm-exports-vhc4-2025-11-04.csv
│   ├── hubspot-crm-exports-vhc5-2025-11-04.csv
│   ├── hubspot-crm-exports-hcu7-2025-11-04.csv
│   ├── hubspot-crm-exports-hcu8-2025-11-04.csv
│   ├── hubspot-crm-exports-hcu9-2025-11-04.csv
│   ├── hubspot-crm-exports-hcu10-2025-11-04.csv
│   ├── hubspot-crm-exports-hcu11-2025-11-04.csv
│   ├── hubspot-crm-exports-hcu12-2025-11-04.csv
│   └── hubspot-crm-exports-hcuandvhc-2025-11-05.csv
├── surveys/
│   ├── HCU7期卒業式アンケート（回答）.xlsx
│   ├── ★８期生　表彰式アンケート（回答）.xlsx
│   ├── 9期生　卒業式アンケート（回答）.xlsx
│   ├── HCU10期 卒業式アンケート（回答）.xlsx
│   └── HCU11期 卒業式アンケート （回答）.xlsx
├── output/
└── possim_customer_priority_maker.py
```

### 2. 必要なライブラリをインストール

```bash
pip install -r requirements.txt
```

### 3. スクリプトを実行

```bash
python possim_customer_priority_maker.py
```

### 4. 出力ファイルを確認

`output/POSSIM_顧客リスト_優先順位付き.xlsx` が生成されます。

## 📊 出力ファイルの構成

### シート1: 営業リスト

営業優先度付き顧客リストです。以下の列が含まれます：

| 列名 | 説明 |
|-----|------|
| 優先順位 | 1～4の営業優先度 |
| 氏名 | 顧客の氏名 |
| 電話番号 | 整形された電話番号 |
| メールアドレス | メールアドレス |
| 郵便番号 | 整形された郵便番号 |
| 住所 | 住所（都道府県 + 市区町村 + 番地） |
| 都道府県 | 都道府県 |
| 最後に受講した期 | 最後に受講した期（VHC1～HCU12） |
| アンケート回答 | 卒業式アンケートに回答したか（True/False） |

**ソート順**: 優先順位の昇順（1→2→3→4）

### シート2: 地域別集計結果

地域別の人数集計です：

| 集計項目 | 説明 |
|---------|------|
| A. 東京都在住 | 東京都在住者数 |
| B. 埼玉・千葉・神奈川在住 | 近県在住者数 |
| C. 7期以降 + 東京都在住 | 7期以降の東京都在住者数 |
| D. 7期以降 + 近県在住 | 7期以降の近県在住者数 |

### シート3: 優先順位別の人数

優先順位別の人数集計です：

| 優先順位 | 説明 |
|---------|------|
| 優先順位1（12期生） | 最後に参加したのが12期 |
| 優先順位2（7～11期 + アンケート回答） | 7～11期 かつ アンケート回答者 |
| 優先順位3（7～11期 + 未回答） | 7～11期 かつ 未回答 |
| 優先順位4（1～6期） | 1～6期 |

### シート4: 各種チェック項目

データ品質チェック結果です：

- 電話番号データ件数
- 郵便番号データ件数
- 住所データ件数
- 都道府県データ件数
- メールアドレスデータ件数
- 住所の重複チェック

## 処理フロー

### ステップ1: 各期のデータを読み込む
VHC1～5期とHCU7～12期の11期分のCSVファイルを読み込みます。

### ステップ2: VHC6期データを差分計算で取得
全体データから11期分を差し引き、VHC6期のデータを取得します。

**計算式**: 全体データ - (VHC1～5 + HCU7～12) = VHC6期データ

### ステップ3: 全12期を統合
11期分 + VHC6期 = 12期分のデータを統合します。

### ステップ4: 氏名正規化とメールアドレスの前処理
- 氏名を作成（姓 + 名）
- 氏名を正規化（スペース・記号を削除）
- メールアドレスを小文字に統一

### ステップ5: 重複削除（最後の期を保持）
1人が複数期に参加している場合、最後に受講した期のデータだけを残します。

### ステップ6: 都道府県情報をマージ
マスターデータから都道府県情報を取得します。

### ステップ7: 都道府県を抽出
住所から都道府県を抽出します。

### ステップ8: 地域別集計
地域別の人数を集計します。

### ステップ9: アンケート情報をマージ
卒業式アンケートの回答情報をマージします。

### ステップ10: 優先順位を付与
営業優先度を計算します。

**優先順位の定義**:
- **優先順位1**: 最後に参加したのが12期
- **優先順位2**: 7～11期 かつ アンケート回答者
- **優先順位3**: 7～11期 かつ 未回答
- **優先順位4**: 1～6期

### ステップ11: 電話番号・郵便番号の整形と住所の作成
- 電話番号を整形（090-1234-5678形式）
- 郵便番号を整形（123-4567形式）
- 住所を作成（都道府県 + 市区町村 + 番地）

### ステップ12: Excel出力（4シート構成）
Excelファイルを出力します。

## 🔍 重要な注意点

### VHC6期データの取得方法

**❌ 使用禁止のファイル**:
- `VHC6期生データ.csv` ← 独自作成のため使用しない
- `6期生以外の全量データ_顧客リスト統合版.xlsx` ← 不正確な可能性があるため使用しない

**✅ 正しい方法**:
差分計算で取得します：

```python
# ステップ1: VHC1～5, HCU7～12の11期分を読み込み
df_non_vhc6 = pd.concat([df_vhc1, df_vhc2, ..., df_vhc5, df_hcu7, ..., df_hcu12])

# ステップ2: 全体データを読み込み
df_all = pd.read_csv('hubspot-crm-exports-hcuandvhc-2025-11-05.csv')

# ステップ3: 差分計算でVHC6期を取得
vhc6_emails = all_emails - non_vhc6_emails
df_vhc6 = df_all[df_all['Eメール'].isin(vhc6_emails)]
```

### 重複削除のロジック

1人が複数期に参加している場合、**最後に受講した期のデータ**を保持します：

```python
# 期_番号を降順ソート（最後の期が先頭に来る）
df_sorted = df.sort_values('期_番号', ascending=False)

# メールアドレスで重複削除（最初のレコード=最後の期を保持）
df_dedup = df_sorted.drop_duplicates(subset=['Eメール'], keep='first')
```

### 電話番号の整形

- **11桁**: 090-1234-5678 形式
- **10桁**: 03-1234-5678 形式
- **その他**: そのまま

## 📝 ライセンス

このプロジェクトは、POSSIMの内部ツールとして作成されました。

## 作成者

KATSUMI KURAHASHI

## 最終更新日

2025-11-05
